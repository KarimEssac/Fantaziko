1- TABLE accounts (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) NOT NULL,
    password VARCHAR(255) NOT NULL,
    phone_number VARCHAR(20) UNIQUE,
    activated BOOLEAN DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
)

2- TABLE admins (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL,
    email VARCHAR(100) NOT NULL,
    password VARCHAR(255) NOT NULL
) 

3- TABLE leagues (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    owner INT NOT NULL,
    other_owner INT DEFAULT NULL,
    num_of_players INT DEFAULT 0,
    num_of_teams INT DEFAULT 0,
    system ENUM('Budget', 'No Limits') DEFAULT 'No Limits',
    triple_captain INT DEFAULT 0,
    bench_boost INT DEFAULT 0,
    wild_card INT DEFAULT 0,
    round INT DEFAULT 1,
    price DECIMAL(10,2) DEFAULT 0.00,
    activated BOOLEAN DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (owner) REFERENCES accounts(id) ON DELETE CASCADE,
    FOREIGN KEY (other_owner) REFERENCES accounts(id) ON DELETE SET NULL
)

4- league_contributors (
    user_id INT NOT NULL,
    league_id INT NOT NULL,
    role ENUM('Contributor', 'Admin') DEFAULT 'Contributor',
    total_score INT DEFAULT 0,
    PRIMARY KEY (user_id, league_id),
    FOREIGN KEY (user_id) REFERENCES accounts(id) ON DELETE CASCADE,
    FOREIGN KEY (league_id) REFERENCES leagues(id) ON DELETE CASCADE
);

5- contributor_players (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    league_id INT NOT NULL,
    player_id INT NOT NULL,
    position ENUM('GK', 'DEF', 'MID', 'ATT') NOT NULL,
    slot_number TINYINT DEFAULT 1,        -- order of player in formation
    is_benched BOOLEAN DEFAULT 0,         -- 0 = starter, 1 = benched
    FOREIGN KEY (player_id) REFERENCES league_players(player_id) ON DELETE CASCADE,
    FOREIGN KEY (user_id, league_id) REFERENCES league_contributors(user_id, league_id) ON DELETE CASCADE,
    INDEX (user_id, league_id),
    INDEX (is_benched)
);

6- league_roles (
    league_id INT PRIMARY KEY,
    gk_save_penalty INT DEFAULT 0,
    gk_score INT DEFAULT 0,
    gk_assist INT DEFAULT 0,
    gk_clean_sheet INT DEFAULT 0,
    def_clean_sheet INT DEFAULT 0,
    def_assist INT DEFAULT 0,
    def_score INT DEFAULT 0,
    mid_assist INT DEFAULT 0,
    mid_score INT DEFAULT 0,
    miss_penalty INT DEFAULT 0,
    for_score INT DEFAULT 0,
    for_assist INT DEFAULT 0,
    yellow_card INT DEFAULT 0,
    red_card INT DEFAULT 0,
    FOREIGN KEY (league_id) REFERENCES leagues(id) ON DELETE CASCADE
)


7- TABLE league_teams (
    id INT AUTO_INCREMENT PRIMARY KEY,
    league_id INT NOT NULL,
    team_name VARCHAR(100) NOT NULL,
    team_score INT DEFAULT 0,
    FOREIGN KEY (league_id) REFERENCES leagues(id) ON DELETE CASCADE
) 


8- TABLE league_players (
    player_id INT AUTO_INCREMENT PRIMARY KEY,
    league_id INT NOT NULL,
    team_id INT NOT NULL,
    player_name VARCHAR(100) NOT NULL,
    player_role ENUM('GK', 'DEF', 'MID', 'ATT') NOT NULL,
    player_price DECIMAL(10,2) DEFAULT 0.00, 
    total_points INT DEFAULT 0,
    FOREIGN KEY (league_id) REFERENCES leagues(id) ON DELETE CASCADE
    FOREIGN KEY (team_id) REFERENCES league_teams(id) ON DELETE SET NULL
) 


9- TABLE matches (
    match_id INT AUTO_INCREMENT PRIMARY KEY,
    league_id INT NOT NULL,
    round INT NOT NULL,
    team1_id INT DEFAULT NULL
    team2_id INT DEFAULT NULL
    team1_score INT DEFAULT 0,
    team2_score INT DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (league_id) REFERENCES leagues(id) ON DELETE CASCADE
    FOREIGN KEY (team1_id) REFERENCES league_teams(id) ON DELETE SET NULL,
    FOREIGN KEY (team2_id) REFERENCES league_teams(id) ON DELETE SET NULL,
)


10- TABLE matches_points (
    id INT AUTO_INCREMENT PRIMARY KEY,
    match_id INT NOT NULL,
    scorer INT DEFAULT NULL,
    assister INT DEFAULT NULL,
    bonus INT DEFAULT NULL,
    bonus_points INT DEFAULT 0,
    minus INT DEFAULT NULL,
    minus_points INT DEFAULT 0,
    saved_penalty_gk INT DEFAULT NULL,
    missed_penalty_player INT DEFAULT NULL,
    yellow_card INT DEFAULT 0,
    yellow_card_player INT DEFAULT NULL,
    red_card INT DEFAULT 0,
    red_card_player INT DEFAULT NULL,
    FOREIGN KEY (match_id) REFERENCES matches(match_id) ON DELETE CASCADE,
    FOREIGN KEY (scorer) REFERENCES league_players(player_id) ON DELETE SET NULL,
    FOREIGN KEY (assister) REFERENCES league_players(player_id) ON DELETE SET NULL,
    FOREIGN KEY (bonus) REFERENCES league_players(player_id) ON DELETE SET NULL,
    FOREIGN KEY (minus) REFERENCES league_players(player_id) ON DELETE SET NULL,
    FOREIGN KEY (saved_penalty_gk) REFERENCES league_players(player_id) ON DELETE SET NULL,
    FOREIGN KEY (missed_penalty_player) REFERENCES league_players(player_id) ON DELETE SET NULL,
    FOREIGN KEY (yellow_card_player) REFERENCES league_players(player_id) ON DELETE SET NULL,
    FOREIGN KEY (red_card_player) REFERENCES league_players(player_id) ON DELETE SET NULL
)  
11- league_tokens (
    id INT AUTO_INCREMENT PRIMARY KEY,
    league_id INT NOT NULL,
    token CHAR(8) UNIQUE NOT NULL,
    FOREIGN KEY (league_id) REFERENCES leagues(id) ON DELETE CASCADE
);
